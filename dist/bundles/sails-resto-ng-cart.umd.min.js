!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@sails-resto/ng-core")):"function"==typeof define&&define.amd?define("@sails-resto/ng-cart",["exports","@angular/core","rxjs","rxjs/operators","@sails-resto/ng-core"],t):t((e["sails-resto"]=e["sails-resto"]||{},e["sails-resto"]["ng-cart"]={}),e.ng.core,e.rxjs,e.rxjs.operators,null)}(this,function(e,s,i,n,o){"use strict";var t=function(){function e(e,t){var r=this;this.net=e,this.eventer=t,this.cart=new i.BehaviorSubject({}),this.modifires=new i.BehaviorSubject([]),this.modifiresMessage=new i.BehaviorSubject([]),this.initialStorage(),this.modifiresMessage.subscribe(function(e){return r.messages=e})}return e.prototype.initialStorage=function(){var t=this;this.cartID=this.getcartIDFromStorage(),this.cartID&&this.net.get("/cart?cartId="+this.cartID).subscribe(function(e){t.cart.next(e.cart)})},e.prototype.getcartIDFromStorage=function(){return localStorage.getItem("cartID")},e.prototype.addDishToCart=function(e){var t=this;this.messages.length?this.messages.forEach(function(e){t.eventer.emitMessageEvent(e)}):this.net.put("/cart/add",e).subscribe(function(e){t.setcartIDFromStorage(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId,t.eventer.emitMessageEvent(new o.EventMessage("success","Успех","Блюдо добавлено в корзину")),console.log(e)},function(e){t.eventer.emitMessageEvent(new o.EventMessage("error","Ошибка","Не удалось добавить блюдо"))})},e.prototype.setDishCountToCart=function(e,t){var r=this;this.net.post("/cart/set",{dishId:e,cartId:this.cartID,amount:t}).subscribe(function(e){r.setcartIDFromStorage(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId,console.log(e)},function(e){r.eventer.emitMessageEvent(new o.EventMessage("error","Ошибка","Не удалось изменить количество"))})},e.prototype.setDishComment=function(e,t){var r=this;return this.net.post("/cart/setcomment",{dishId:e,cartId:this.cartID,comment:t}).pipe(n.tap(function(e){r.setcartIDFromStorage(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId},function(e){r.eventer.emitMessageEvent(new o.EventMessage("error","Ошибка","Не удалось изменить коментарий"))}))},e.prototype.removeDishFromCart=function(e,t){var r=this;this.net.put("/cart/remove",{dishId:e,cartId:this.cartID,amount:t}).subscribe(function(e){r.setcartIDFromStorage(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId,r.eventer.emitMessageEvent(new o.EventMessage("success","Успех","Блюдо успешно удалено")),console.log(e)},function(e){r.eventer.emitMessageEvent(new o.EventMessage("error","Ошибка","Не удалось удалить блюдо"))})},e.prototype.checkoutCart=function(e){var t={cartId:this.cartID,address:{streetId:e.street.id,home:e.house,housing:e.housing,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:e.phone,name:e.name,mail:e.email||undefined}};return this.orderCart(t)},e.prototype.orderCart=function(e){var t=this;return this.net.post("/order",e).pipe(n.tap(function(e){t.setcartIDFromStorage(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId,t.eventer.emitMessageEvent(new o.EventMessage("success","Успех","Заказ упешно оформлен"))},function(e){console.log("Ошибка оформления!",e),e.error&&e.error.cart&&(t.setcartIDFromStorage(e.error.cart.cartId),t.cart.next(e.error.cart),t.cartID=e.error.cart.cartId),e.message?t.eventer.emitMessageEvent(new o.EventMessage(e.message.type,e.message.title,e.message.body)):t.eventer.emitMessageEvent(new o.EventMessage("error","Ошибка","Не удалось оформить заказ"))}))},e.prototype.checkStreet=function(e){var t=this;this.net.post("/check",e).subscribe(function(e){t.setcartIDFromStorage(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId,e.message&&t.eventer.emitMessageEvent(new o.EventMessage(e.message.type,e.message.title,e.message.body))},function(e){e.error&&(e.error.cart&&(t.setcartIDFromStorage(e.error.cart.cartId),t.cart.next(e.error.cart),t.cartID=e.error.cart.cartId),t.eventer.emitMessageEvent(new o.EventMessage(e.error.message.type,e.error.message.title,e.error.message.body)))})},e.prototype.setcartIDFromStorage=function(e){localStorage.setItem("cartID",e)},e.prototype.userCart=function(){return this.cart},e.prototype.setModifires=function(e,t){this.modifires.next(e),t&&this.modifiresMessage.next(t)},e.prototype.getModifires=function(){return this.modifires},e.decorators=[{type:s.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:o.NetService},{type:o.EventerService}]},e.ngInjectableDef=s.defineInjectable({factory:function(){return new e(s.inject(o.NetService),s.inject(o.EventerService))},token:e,providedIn:"root"}),e}(),r=function(){function e(e){var t=this;this.cartService=e,this.cartService.userCart().subscribe(function(e){return t.cart=e}),this.cartService.getModifires().subscribe(function(e){return t.modifires=e})}return e.prototype.onClick=function(){this.addDishToCart(this.dish.id,this.amountDish)},e.prototype.addDishToCart=function(e,t){var r={dishId:e,amount:t,cartId:undefined,modifiers:this.modifires,comment:this.comment};console.log("другие даные",r),this.cart.cartId&&(r.cartId=this.cart.cartId),this.cartService.addDishToCart(r)},e.decorators=[{type:s.Directive,args:[{selector:"[addToCart]"}]}],e.ctorParameters=function(){return[{type:t}]},e.propDecorators={dish:[{type:s.Input}],amountDish:[{type:s.Input}],comment:[{type:s.Input}],onClick:[{type:s.HostListener,args:["click"]}]},e}(),a=function(){function e(e,t,r){var i=this;this.cartService=e,this.renderer=t,this.el=r,this.amount="0",this.renderer.setProperty(this.el.nativeElement,"innerHTML",this.amount),this.cartService.userCart().subscribe(function(e){i.cart=e,i.amount=e.dishesCount||0,i.renderer.setProperty(i.el.nativeElement,"innerHTML",i.amount)})}return e.decorators=[{type:s.Directive,args:[{selector:"[amountCart]"}]}],e.ctorParameters=function(){return[{type:t},{type:s.Renderer2},{type:s.ElementRef}]},e}(),d=function(){function e(e){var t=this;this.cartService=e,this.cartService.userCart().subscribe(function(e){return t.cart=e})}return e.prototype.onClick=function(){this.cartService.removeDishFromCart(this.dish.id,this.amountDish)},e.decorators=[{type:s.Directive,args:[{selector:"[deleteFromCart]"}]}],e.ctorParameters=function(){return[{type:t}]},e.propDecorators={dish:[{type:s.Input}],amountDish:[{type:s.Input}],onClick:[{type:s.HostListener,args:["click"]}]},e}(),c=function(){function e(e){this.cartService=e,this.requiredFields=["name","phone","street","house"],this.checkerFields=new i.BehaviorSubject(undefined)}return e.prototype.onClick=function(){this.order(this.orderCart.value),console.log(this.orderCart.value)},e.prototype.ngAfterViewInit=function(){var t=this;setTimeout(function(){t.cartService.userCart().subscribe(function(e){t.cart&&t.orderCart.valid&&t.cart.cartTotal!=e.cartTotal&&0<e.cartTotal&&t.checkStreet(t.orderCart.value),t.cart=e})},100),setTimeout(function(){t.checkerFields.next(t.checkForFields(t.orderCart._directives,t.requiredFields))},100),this.checkerFields.subscribe(function(e){e&&(t.orderCart.controls.street.valueChanges.subscribe(function(e){"object"==typeof e&&setTimeout(function(){t.orderCart.controls.house.valid&&(t.orderCart.value.name=t.orderCart.value.name||"Неуказано",t.orderCart.value.phone=t.orderCart.value.phone||"78888888888",t.checkStreet(t.orderCart.value))},100)}),t.orderCart.controls.house.valueChanges.subscribe(function(e){setTimeout(function(){t.orderCart.controls.street.valid&&(t.orderCart.value.name=t.orderCart.value.name||"Неуказано",t.orderCart.value.phone=t.orderCart.value.phone||"78888888888",t.checkStreet(t.orderCart.value))},100)}))})},e.prototype.checkForFields=function(e,t){var r={},i=[];return e.forEach(function(e){r[e.name]=!0}),t.forEach(function(e){r.hasOwnProperty(e)||i.push(e)}),i.length<=0||(console.error("У формы отсутсвуют следующие обязательные для корректной работы модуля поля:",i),!1)},e.prototype.order=function(e){if(this.checkForFields(this.orderCart._directives,this.requiredFields)){var t=void 0,r=e.comment||"Не указан";t=e.cash?"Наличными курьеру":e.bankcard?"Банковской картой курьеру":"Не указан",console.log(e);var i={cartId:this.cart.cartId,comment:"\n Тип оплаты:"+t+"\nКоментарий:"+r,address:{streetId:e.street.id,home:this.stringToNumber(e.house),housing:e.housing,doorphone:e.doorphone,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:"+"+e.phone,mail:e.email,name:e.name},personsCount:e.personsCount};this.cartService.orderCart(i).subscribe()}},e.prototype.checkStreet=function(e){if(console.info(this.cart),this.checkForFields(this.orderCart._directives,this.requiredFields)){var t={cartId:this.cart.cartId,comment:e.comment,address:{streetId:e.street.id,home:this.stringToNumber(e.house),housing:e.housing,doorphone:e.doorphone,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:"+"+e.phone,mail:e.email,name:e.name},personsCount:e.personsCount};this.cartService.checkStreet(t)}},e.prototype.stringToNumber=function(e){return console.log(typeof e),"string"==typeof e?+e:"number"==typeof e?e:void console.error("Параметр home должен быть или string или number")},e.decorators=[{type:s.Directive,args:[{selector:"[orderCart]"}]}],e.ctorParameters=function(){return[{type:t}]},e.propDecorators={orderCart:[{type:s.Input}],onClick:[{type:s.HostListener,args:["click"]}]},e}(),h=function(){function e(e){var t=this;this.cartService=e,this.cartService.userCart().subscribe(function(e){return t.cart=e})}return e.prototype.onClick=function(){this.changeAmount(this.action)},e.prototype.changeAmount=function(e){switch(e){case"+":this.cartService.setDishCountToCart(this.dish.id,this.dish.amount+1);break;case"-":this.cartService.setDishCountToCart(this.dish.id,this.dish.amount-1);break;default:console.log("Директива SetDishAmount получила ложное значение action")}},e.decorators=[{type:s.Directive,args:[{selector:"[setDishAmount]"}]}],e.ctorParameters=function(){return[{type:t}]},e.propDecorators={action:[{type:s.Input}],dish:[{type:s.Input}],onClick:[{type:s.HostListener,args:["click"]}]},e}(),u=function(){function e(e,t,r){var i=this;this.renderer=e,this.el=t,this.cartService=r,this.validate=new s.EventEmitter,this.amountDishToAdd=new s.EventEmitter,this.amountModifires={},this.stateModifiers={},this.renderer.addClass(this.el.nativeElement,"dish-calculator"),this.amountDish=1,this.amountDishToAdd.emit(this.amountDish),this.price=this.renderer.createElement("div"),this.renderer.addClass(this.price,"dish-price"),setTimeout(function(){i.renderDish(i.dish),i.render(i.dish.modifiers)},100)}return e.prototype.renderDish=function(e){var t=this,r=this.renderer.createElement("div");this.renderer.addClass(r,"dish-wraper"),this.renderer.appendChild(this.el.nativeElement,r);var i=this.renderer.createElement("div");this.renderer.addClass(i,"name"),this.renderer.appendChild(r,i);var s=this.renderer.createElement("div");this.renderer.addClass(s,"title"),this.renderer.setProperty(s,"innerHTML",this.dish.name),this.renderer.appendChild(i,s);var n=this.renderer.createElement("div");this.renderer.addClass(i,"weight"),this.renderer.addClass(i,"dish"),this.renderer.appendChild(r,n);var o=this.renderer.createElement("div");this.renderer.addClass(o,"value"),this.renderer.setProperty(o,"innerHTML",1e3*this.dish.weight+" г."),0!==this.dish.weight&&this.dish.weight||this.renderer.addClass(o,"zero"),this.renderer.appendChild(n,o),this.renderer.setProperty(this.price,"innerHTML",this.dish.price);var a=this.renderer.createElement("div");this.renderer.addClass(a,"price"),this.renderer.addClass(a,"total"),this.renderer.appendChild(a,this.price),this.renderer.appendChild(r,a);var d=this.renderer.createElement("div");this.renderer.addClass(d,"quantity"),this.renderer.appendChild(r,d);var c=this.renderer.createElement("a");this.renderer.addClass(c,"quantity__button"),this.renderer.addClass(c,"minus"),this.renderer.setProperty(c,"innerHTML","&#8722;"),this.renderer.listen(c,"click",function(e){t.changeAmountdish(-1),t.renderer.setProperty(h,"innerHTML",t.amountDish),t.renderer.setProperty(t.price,"innerHTML",t.generatePrice(t.dish.price)),t.innerTotalWeight(m)}),this.renderer.appendChild(d,c);var h=this.renderer.createElement("span");this.renderer.addClass(h,"quantity__counter"),this.renderer.setProperty(h,"innerHTML",this.amountDish),this.renderer.appendChild(d,h);var u=this.renderer.createElement("a");this.renderer.addClass(u,"quantity__button"),this.renderer.addClass(c,"plus"),this.renderer.setProperty(u,"innerHTML","&#x2b;"),this.renderer.listen(u,"click",function(e){t.changeAmountdish(1),t.renderer.setProperty(h,"innerHTML",t.amountDish),t.renderer.setProperty(t.price,"innerHTML",t.generatePrice(t.dish.price)),t.innerTotalWeight(m)}),this.renderer.appendChild(d,u);var p=this.renderer.createElement("div");this.renderer.addClass(i,"weight"),this.renderer.addClass(i,"total"),this.renderer.appendChild(r,p);var m=this.renderer.createElement("div");0!==this.dish.weight&&this.dish.weight||this.renderer.addClass(m,"zero"),this.renderer.addClass(m,"value"),this.innerTotalWeight(m),this.renderer.appendChild(p,m),this.weightTotal=m,this.renderer.setProperty(this.price,"innerHTML",this.generatePrice(e.price));var l=this.renderer.createElement("div");this.renderer.addClass(l,"price"),this.renderer.addClass(l,"total"),this.renderer.appendChild(l,this.price),this.renderer.appendChild(r,l)},e.prototype.generatePrice=function(e,t,r){var i=this,s=[];this.selectedModifiers&&this.selectedModifiers.forEach(function(r){i.dish.modifiers.forEach(function(e){var t=e.childModifiers.filter(function(e){return e.modifierId===r.id});0<t.length&&(t[0].groupId=e.group.id,s.push(t[0]))})});var n=0;return s.forEach(function(e){n+=e.dish.price*i.amountModifires[e.groupId][e.modifierId]}),n*=this.amountDish,e*this.amountDish+n+'<div class="currency">&nbsp;&#x20bd;</div>'},e.prototype.generateTotalWeight=function(){var t=this,i=[];this.selectedModifiers&&this.selectedModifiers.forEach(function(r){t.dish.modifiers.forEach(function(e){var t=e.childModifiers.filter(function(e){return e.modifierId===r.id});0<t.length&&(t[0].groupId=e.group.id,i.push(t[0]))})});var r=0;return i.forEach(function(e){r+=e.dish.weight*t.amountModifires[e.groupId][e.modifierId]*1e3}),r=parseFloat((r*this.amountDish).toFixed(2)),console.log(r,1e3*this.dish.weight*this.amountDish),console.log(this.dish.weight,this.amountDish),1e3*this.dish.weight*this.amountDish+r+" г. <div class='separator'></div>"},e.prototype.innerTotalWeight=function(e){this.renderer.setProperty(e,"innerHTML",this.generateTotalWeight())},e.prototype.changeAmountdish=function(e){this.amountDish=this.amountDish+e,this.amountDish<=0&&(this.amountDish=1),199<=this.amountDish&&(this.amountDish=199),this.amountDishToAdd.emit(this.amountDish)},e.prototype.render=function(e){var s=this;if(this.setModifires(),0<e.length){var t=this.renderer.createElement("h5");this.renderer.setProperty(t,"innerHTML","К этому блюду можно добавить:")}if(e.forEach(function(r){s.stateModifiers[r.modifierId]={},s.amountModifires[r.modifierId]={};var i=s.groupDiv(r.group?r.group.name:"Ошибка");s.renderer.appendChild(s.el.nativeElement,i),r.childModifiers.forEach(function(e){var t=s.modifireDiv(e,r.modifierId);s.renderer.appendChild(i,t),e.defaultAmount<1?s.stateModifiers[r.modifierId][e.modifierId]=!1:s.stateModifiers[r.modifierId][e.modifierId]=!0})}),0<e.length){t=this.renderer.createElement("div");this.renderer.setProperty(t,"innerHTML","<p>* — Количество добавленых опций блюда применяется для каждой порции</p>"),this.renderer.appendChild(this.el.nativeElement,t)}},e.prototype.groupDiv=function(e){var t=this.renderer.createElement("div");return this.renderer.addClass(t,"group-modifires-wraper"),this.renderer.appendChild(t,this.renderer.createText(""+e)),t},e.prototype.modifireDiv=function(e,t){var r=this.renderer.createElement("div");return this.renderer.addClass(r,"additional-item"),this.renderOneModifire(e,r,t),r},e.prototype.renderOneModifire=function(e,t,r){console.info("renderOneModifire",e),console.info("renderOneModifire selectedModifiers",this.selectedModifiers);var i=this.renderer.createElement("div");this.renderer.addClass(i,"item-name");var s=this.renderer.createElement("label");this.renderer.setAttribute(s,"for",e.modifierId),this.renderer.appendChild(i,s),this.renderer.setProperty(s,"innerHTML",e.dish.name),this.renderer.appendChild(t,i);var n=this.renderer.createElement("div");this.renderer.addClass(n,"left-weight-modifire-wraper");var o=this.renderer.createElement("div");this.renderer.addClass(o,"weight"),(0===e.dish.weight||e.dish.weight<0)&&this.renderer.addClass(o,"zero"),this.renderer.setProperty(o,"innerHTML",1e3*e.dish.weight+" г."),this.renderer.appendChild(n,o),this.renderer.appendChild(t,n);var a=this.renderer.createElement("div"),d=e.minAmount,c=e.maxAmount,h=e.defaultAmount;switch(console.info("min max def",d,c,h),!0){case 0===d&&0===c&&0===h:case 0===d&&1===c&&0===h:this.renderCheckbox(e,!1,a,t,r);break;case 0===d&&1===c&&1===h:this.renderCheckbox(e,!0,a,t,r);break;case 1===d&&1===c&&1===h:console.error(e.dish.name,"Значение не поддается настройке:",d,c,h);break;case d<=c&&d<=h&&h<=c&&1<c:this.renderInputButton(e,r,a,t);break;default:console.error(e.dish.name,"Ошибка рендера модификатора, для значений:",d,c,h)}0<e.maxAmount&&e.minAmount;var u=this.renderer.createElement("div");this.renderer.addClass(u,"right-weight-modifire-wraper");var p=this.renderer.createElement("div");this.renderer.addClass(p,"weight"),(0===e.dish.weight||e.dish.weight<0)&&this.renderer.addClass(p,"zero"),this.renderer.setProperty(p,"innerHTML",1e3*e.dish.weight+' г.<div class="separator"></div>'),this.renderer.appendChild(u,p),this.renderer.appendChild(t,u);var m,l=this.renderer.createElement("div");this.renderer.addClass(l,"item-price"),0<e.dish.price?(m=e.dish.price+"<div class = 'currency'>&nbsp;&#x20bd;</div>",this.renderer.setProperty(l,"innerHTML",m),this.renderer.appendChild(t,l)):this.renderer.addClass(l,"zero-price"),this.setModifires(),this.innerTotalWeight(this.weightTotal),this.renderer.setProperty(this.price,"innerHTML",this.generatePrice(this.dish.price))},e.prototype.renderCheckbox=function(e,t,r,i,s){var n=this,o=this.renderer.createElement("input");this.renderer.setAttribute(o,"type","checkbox"),this.renderer.setAttribute(o,"id",e.modifierId),this.amountModifires[s][e.modifierId]=t?(this.renderer.setProperty(o,"checked",!0),e.checked=!0,this.stateModifiers[s][e.modifierId]=!0,1):(e.checked=!1,this.stateModifiers[s][e.modifierId]=!1,0),this.renderer.addClass(o,"modal-checkbox"),this.renderer.appendChild(r,o),this.renderer.listen(o,"change",function(t){if(n.idRadioBox(s)){for(var e in n.stateModifiers[s])n.stateModifiers[s].hasOwnProperty(e)&&(n.stateModifiers[s][e]=!1);t.target.parentElement.parentElement.parentElement.querySelectorAll("input").forEach(function(e){e.id!=t.target.id&&(e.checked=!1)})}n.stateModifiers[s][t.target.id]=t.target.checked,t.target.checked&&(n.amountModifires[s][t.target.id]=1),n.setModifires(),n.innerTotalWeight(n.weightTotal),n.renderer.setProperty(n.price,"innerHTML",n.generatePrice(n.dish.price))}),this.renderer.appendChild(i,r)},e.prototype.renderInputButton=function(r,i,e,t){var s,n=this;0<(s=0<r.defaultAmount?r.defaultAmount:r.minAmount)&&(this.stateModifiers[i][r.modifierId]=!0);var o=this.renderer.createElement("a");this.renderer.addClass(o,"quantity__button"),this.renderer.setProperty(o,"innerHTML","&#8722;"),this.renderer.appendChild(e,o),this.renderer.listen(o,"click",function(e){var t=+n.amountModifires[i][r.modifierId];n.amountModifires[i][r.modifierId]=t-1,n.amountModifires[i][r.modifierId]<r.minAmount&&(n.amountModifires[i][r.modifierId]=r.minAmount),n.renderer.setProperty(a,"innerHTML",n.amountModifires[i][r.modifierId]),0===n.amountModifires[i][r.modifierId]&&(n.stateModifiers[i][r.modifierId]=!1),n.setModifires(),n.innerTotalWeight(n.weightTotal),n.renderer.setProperty(n.price,"innerHTML",n.generatePrice(n.dish.price))});var a=this.renderer.createElement("span");this.renderer.addClass(a,"item-quantity__counter"),this.amountModifires[i][r.modifierId]=s,this.renderer.setProperty(a,"innerHTML",this.amountModifires[i][r.modifierId]),this.renderer.appendChild(e,a);var d=this.renderer.createElement("a");this.renderer.addClass(d,"quantity__button"),this.renderer.setProperty(d,"innerHTML","&#x2b;"),this.renderer.appendChild(e,d),this.renderer.appendChild(t,e),this.renderer.listen(d,"click",function(e){var t=+n.amountModifires[i][r.modifierId];n.amountModifires[i][r.modifierId]=t+1,n.amountModifires[i][r.modifierId]>r.maxAmount&&0!=r.maxAmount&&(n.amountModifires[i][r.modifierId]=r.maxAmount),n.renderer.setProperty(a,"innerHTML",n.amountModifires[i][r.modifierId]),0<n.amountModifires[i][r.modifierId]&&(n.stateModifiers[i][r.modifierId]=!0),n.setModifires(),n.innerTotalWeight(n.weightTotal),n.renderer.setProperty(n.price,"innerHTML",n.generatePrice(n.dish.price))})},e.prototype.setModifires=function(){var s=this,e=[],n=[];for(var r in console.info("setModifires modifiersToSelect",e),console.info("setModifires stateModifiers before",this.stateModifiers),console.info("setModifires selectedModifiers before",this.selectedModifiers),this.stateModifiers){var t=function(t){(i.stateModifiers[r][t]||e.find(function(e){return e.modifierId==t}))&&n.push({id:t,amount:i.amountModifires[r][t],groupId:r})},i=this;for(var o in this.stateModifiers[r])t(o)}if(this.selectedModifiers=n,0<this.dish.modifiers.length){var a=[];this.dish.modifiers.forEach(function(e){if(e.required)if(s.stateModifiers[e.modifierId]){var t=[],r=s.stateModifiers[e.modifierId];for(var i in r)r.hasOwnProperty(i)&&r[i]&&t.push(r[i]);t.length<e.minAmount?(a.push({type:"warning",title:"Внимание",body:" Обязательно выберите модификаторы из категории: "+e.group.name}),s.validate.emit(!1),s.cartService.setModifires(n,a)):(s.validate.emit(!0),s.cartService.setModifires(n,[]))}else a.push({type:"warning",title:"Внимание",body:" Обязательно выберите модификаторы из категории: "+e.group.name}),s.validate.emit(!1),s.cartService.setModifires(n,a);else s.validate.emit(!0),s.cartService.setModifires(n)})}else this.validate.emit(!0),this.cartService.setModifires(n,[]);console.info("setModifires stateModifiers after",this.stateModifiers),console.info("setModifires selectedModifiers after",this.selectedModifiers)},e.prototype.idRadioBox=function(t){var e=this.dish.modifiers.find(function(e){return e.modifierId===t});return 1===e.minAmount&&1===e.maxAmount},e.prototype.checkMinAmountModifires=function(e,t){},e.prototype.ngOnDestroy=function(){this.validate.emit(!0),this.cartService.setModifires([],[])},e.decorators=[{type:s.Directive,args:[{selector:"[dishCalc]"}]}],e.ctorParameters=function(){return[{type:s.Renderer2},{type:s.ElementRef},{type:t}]},e.propDecorators={dish:[{type:s.Input}],amount:[{type:s.Input}],selectedModifiers:[{type:s.Input}],validate:[{type:s.Output}],amountDishToAdd:[{type:s.Output}]},e}(),p=function(){function e(e){var t=this;this.cartService=e,this.success=new s.EventEmitter,this.error=new s.EventEmitter,this.cartService.userCart().subscribe(function(e){return t.cart=e})}return e.prototype.onClick=function(){var t=this;if(this.locationId||this.streetId&&this.home){var e=this.comment||"Не указан",r=this.paymentMethod||"Не указано",i={cartId:this.cart.cartId,comment:e+"\r\nОплата: "+r,customer:{phone:this.preparePhone(this.phone),mail:this.email,name:this.name},personsCount:this.personsCount};this.delivery&&(i.delivery={type:"self"}),this.locationId?i.locationId=this.locationId:i.address={streetId:this.streetId,home:+this.home,housing:this.housing,doorphone:this.doorphone||"",entrance:this.entrance||"",floor:this.floor||"",apartment:this.apartment||""},this.cartService.orderCart(i).subscribe(function(){return t.success.emit(!0)},function(e){return t.error.emit(e)})}else this.error.emit("Нужно указать адрес")},e.prototype.preparePhone=function(e){return(e="+"+e.replace(/[^0-9]/gim,"")).replace("+8","")},e.decorators=[{type:s.Directive,args:[{selector:"[checkout]"}]}],e.ctorParameters=function(){return[{type:t}]},e.propDecorators={name:[{type:s.Input}],email:[{type:s.Input}],phone:[{type:s.Input}],delivery:[{type:s.Input}],locationId:[{type:s.Input}],streetId:[{type:s.Input}],home:[{type:s.Input}],housing:[{type:s.Input}],apartment:[{type:s.Input}],entrance:[{type:s.Input}],doorphone:[{type:s.Input}],floor:[{type:s.Input}],paymentMethod:[{type:s.Input}],personsCount:[{type:s.Input}],comment:[{type:s.Input}],success:[{type:s.Output}],error:[{type:s.Output}],onClick:[{type:s.HostListener,args:["click"]}]},e}(),m=function(){function e(e){this.cartService=e,this.success=new s.EventEmitter,this.error=new s.EventEmitter}return e.prototype.onClick=function(){this.setComment()},e.prototype.setComment=function(){var t=this;this.cartService.setDishComment(this.dish.id,this.comment).subscribe(function(e){return t.success.emit(!0)},function(e){return t.error.emit(e)})},e.decorators=[{type:s.Directive,args:[{selector:"[setDishComment]"}]}],e.ctorParameters=function(){return[{type:t}]},e.propDecorators={comment:[{type:s.Input}],dish:[{type:s.Input}],success:[{type:s.Output}],error:[{type:s.Output}],onClick:[{type:s.HostListener,args:["click"]}]},e}(),l=[r,a,d,c,u,m,h,p],f=[],v=function(){function e(){}return e.decorators=[{type:s.NgModule,args:[{imports:[f],providers:[],declarations:[l],exports:[l]}]}],e}();e.NgRestoCartService=t,e.NgRestoCartModule=v,e.ɵa=r,e.ɵb=a,e.ɵh=p,e.ɵc=d,e.ɵe=u,e.ɵd=c,e.ɵg=h,e.ɵf=m,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=sails-resto-ng-cart.umd.min.js.map