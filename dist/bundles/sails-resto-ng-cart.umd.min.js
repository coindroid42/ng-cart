!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@sails-resto/ng-core")):"function"==typeof define&&define.amd?define("@sails-resto/ng-cart",["exports","@angular/core","rxjs","rxjs/operators","@sails-resto/ng-core"],r):r((e["sails-resto"]=e["sails-resto"]||{},e["sails-resto"]["ng-cart"]={}),e.ng.core,e.rxjs,e.rxjs.operators,null)}(this,function(e,n,i,t,s){"use strict";var r=function(){function e(e,r){var t=this;this.net=e,this.eventer=r,this.cart=new i.BehaviorSubject({}),this.modifires=new i.BehaviorSubject([]),this.modifiresMessage=new i.BehaviorSubject([]),this.initialStorage(),this.modifiresMessage.subscribe(function(e){return t.messages=e})}return e.prototype.initialStorage=function(){var r=this;this.cartID=this.getcartIDFromStorage(),this.cartID&&this.net.get("/cart?cartId="+this.cartID).subscribe(function(e){r.cart.next(e.cart)})},e.prototype.getcartIDFromStorage=function(){return localStorage.getItem("cartID")},e.prototype.addDishToCart=function(e){var r=this;this.messages.length?this.messages.forEach(function(e){r.eventer.emitMessageEvent(e)}):this.net.put("/cart/add",e).subscribe(function(e){r.setcartIDFromStorage(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId,r.eventer.emitMessageEvent(new s.EventMessage("success","Успех","Блюдо добавлено в корзину")),console.log(e)},function(e){r.eventer.emitMessageEvent(new s.EventMessage("error","Ошибка","Не удалось добавить блюдо"))})},e.prototype.setDishCountToCart=function(e,r){var t=this;this.net.post("/cart/set",{dishId:e,cartId:this.cartID,amount:r}).subscribe(function(e){t.setcartIDFromStorage(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId,console.log(e)},function(e){t.eventer.emitMessageEvent(new s.EventMessage("error","Ошибка","Не удалось изменить количество"))})},e.prototype.removeDishFromCart=function(e,r){var t=this;this.net.put("/cart/remove",{dishId:e,cartId:this.cartID,amount:r}).subscribe(function(e){t.setcartIDFromStorage(e.cart.cartId),t.cart.next(e.cart),t.cartID=e.cart.cartId,t.eventer.emitMessageEvent(new s.EventMessage("success","Успех","Блюдо успешно удалено")),console.log(e)},function(e){t.eventer.emitMessageEvent(new s.EventMessage("error","Ошибка","Не удалось удалить блюдо"))})},e.prototype.checkoutCart=function(e){var r={cartId:this.cartID,address:{streetId:e.street.id,home:e.house,housing:e.housing,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:e.phone,name:e.name,mail:e.email||undefined}};return this.orderCart(r)},e.prototype.orderCart=function(e){var r=this;return this.net.post("/order",e).pipe(t.tap(function(e){r.setcartIDFromStorage(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId,r.eventer.emitMessageEvent(new s.EventMessage("success","Успех","Заказ упешно оформлен"))},function(e){console.log("Ошибка оформления!",e),e.error&&e.error.cart&&(r.setcartIDFromStorage(e.error.cart.cartId),r.cart.next(e.error.cart),r.cartID=e.error.cart.cartId),e.message?r.eventer.emitMessageEvent(new s.EventMessage(e.message.type,e.message.title,e.message.body)):r.eventer.emitMessageEvent(new s.EventMessage("error","Ошибка","Не удалось оформить заказ"))}))},e.prototype.checkStreet=function(e){var r=this;this.net.post("/check",e).subscribe(function(e){r.setcartIDFromStorage(e.cart.cartId),r.cart.next(e.cart),r.cartID=e.cart.cartId,e.message&&r.eventer.emitMessageEvent(new s.EventMessage(e.message.type,e.message.title,e.message.body))},function(e){e.error&&(e.error.cart&&(r.setcartIDFromStorage(e.error.cart.cartId),r.cart.next(e.error.cart),r.cartID=e.error.cart.cartId),r.eventer.emitMessageEvent(new s.EventMessage(e.error.message.type,e.error.message.title,e.error.message.body)))})},e.prototype.setcartIDFromStorage=function(e){localStorage.setItem("cartID",e)},e.prototype.userCart=function(){return this.cart},e.prototype.setModifires=function(e,r){this.modifires.next(e),r&&this.modifiresMessage.next(r)},e.prototype.getModifires=function(){return this.modifires},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:s.NetService},{type:s.EventerService}]},e.ngInjectableDef=n.defineInjectable({factory:function(){return new e(n.inject(s.NetService),n.inject(s.EventerService))},token:e,providedIn:"root"}),e}();function o(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var i,n,s=t.call(e),o=[];try{for(;(void 0===r||0<r--)&&!(i=s.next()).done;)o.push(i.value)}catch(a){n={error:a}}finally{try{i&&!i.done&&(t=s["return"])&&t.call(s)}finally{if(n)throw n.error}}return o}function a(){for(var e=[],r=0;r<arguments.length;r++)e=e.concat(o(arguments[r]));return e}var d=function(){function e(e){var r=this;this.cartService=e,this.cartService.userCart().subscribe(function(e){return r.cart=e}),this.cartService.getModifires().subscribe(function(e){return r.modifires=e})}return e.prototype.onClick=function(){this.addDishToCart(this.dish.id,this.amountDish)},e.prototype.addDishToCart=function(e,r){var t={dishId:e,amount:r,cartId:undefined,modifiers:this.modifires};console.log("другие даные",t),this.cart.cartId&&(t.cartId=this.cart.cartId),this.cartService.addDishToCart(t)},e.decorators=[{type:n.Directive,args:[{selector:"[addToCart]"}]}],e.ctorParameters=function(){return[{type:r}]},e.propDecorators={dish:[{type:n.Input}],amountDish:[{type:n.Input}],onClick:[{type:n.HostListener,args:["click"]}]},e}(),c=function(){function e(e,r,t){var i=this;this.cartService=e,this.renderer=r,this.el=t,this.amount="0",this.renderer.setProperty(this.el.nativeElement,"innerHTML",this.amount),this.cartService.userCart().subscribe(function(e){i.cart=e,i.amount=e.dishesCount||0,i.renderer.setProperty(i.el.nativeElement,"innerHTML",i.amount)})}return e.decorators=[{type:n.Directive,args:[{selector:"[amountCart]"}]}],e.ctorParameters=function(){return[{type:r},{type:n.Renderer2},{type:n.ElementRef}]},e}(),h=function(){function e(e){var r=this;this.cartService=e,this.cartService.userCart().subscribe(function(e){return r.cart=e})}return e.prototype.onClick=function(){this.cartService.removeDishFromCart(this.dish.id,this.amountDish)},e.decorators=[{type:n.Directive,args:[{selector:"[deleteFromCart]"}]}],e.ctorParameters=function(){return[{type:r}]},e.propDecorators={dish:[{type:n.Input}],amountDish:[{type:n.Input}],onClick:[{type:n.HostListener,args:["click"]}]},e}(),u=function(){function e(e){this.cartService=e,this.requiredFields=["name","phone","street","house"],this.checkerFields=new i.BehaviorSubject(undefined)}return e.prototype.onClick=function(){this.order(this.orderCart.value),console.log(this.orderCart.value)},e.prototype.ngAfterViewInit=function(){var r=this;setTimeout(function(){r.cartService.userCart().subscribe(function(e){r.cart&&r.orderCart.valid&&r.cart.cartTotal!=e.cartTotal&&0<e.cartTotal&&r.checkStreet(r.orderCart.value),r.cart=e})},100),setTimeout(function(){r.checkerFields.next(r.checkForFields(r.orderCart._directives,r.requiredFields))},100),this.checkerFields.subscribe(function(e){e&&(r.orderCart.controls.street.valueChanges.subscribe(function(e){"object"==typeof e&&setTimeout(function(){r.orderCart.controls.house.valid&&(r.orderCart.value.name=r.orderCart.value.name||"Неуказано",r.orderCart.value.phone=r.orderCart.value.phone||"78888888888",r.checkStreet(r.orderCart.value))},100)}),r.orderCart.controls.house.valueChanges.subscribe(function(e){setTimeout(function(){r.orderCart.controls.street.valid&&(r.orderCart.value.name=r.orderCart.value.name||"Неуказано",r.orderCart.value.phone=r.orderCart.value.phone||"78888888888",r.checkStreet(r.orderCart.value))},100)}))})},e.prototype.checkForFields=function(e,r){var t={},i=[];return e.forEach(function(e){t[e.name]=!0}),r.forEach(function(e){t.hasOwnProperty(e)||i.push(e)}),i.length<=0||(console.error("У формы отсутсвуют следующие обязательные для корректной работы модуля поля:",i),!1)},e.prototype.order=function(e){if(this.checkForFields(this.orderCart._directives,this.requiredFields)){var r=void 0,t=e.comment||"Не указан";r=e.cash?"Наличными курьеру":e.bankcard?"Банковской картой курьеру":"Не указан",console.log(e);var i={cartId:this.cart.cartId,comment:"\n Тип оплаты:"+r+"\nКоментарий:"+t,address:{streetId:e.street.id,home:this.stringToNumber(e.house),housing:e.housing,doorphone:e.doorphone,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:"+"+e.phone,mail:e.email,name:e.name},personsCount:e.personsCount};this.cartService.orderCart(i).subscribe()}},e.prototype.checkStreet=function(e){if(console.info(this.cart),this.checkForFields(this.orderCart._directives,this.requiredFields)){var r={cartId:this.cart.cartId,comment:e.comment,address:{streetId:e.street.id,home:this.stringToNumber(e.house),housing:e.housing,doorphone:e.doorphone,entrance:e.entrance,floor:e.floor,apartment:e.apartment},customer:{phone:"+"+e.phone,mail:e.email,name:e.name},personsCount:e.personsCount};this.cartService.checkStreet(r)}},e.prototype.stringToNumber=function(e){return console.log(typeof e),"string"==typeof e?+e:"number"==typeof e?e:void console.error("Параметр home должен быть или string или number")},e.decorators=[{type:n.Directive,args:[{selector:"[orderCart]"}]}],e.ctorParameters=function(){return[{type:r}]},e.propDecorators={orderCart:[{type:n.Input}],onClick:[{type:n.HostListener,args:["click"]}]},e}(),p=function(){function e(e){var r=this;this.cartService=e,this.cartService.userCart().subscribe(function(e){return r.cart=e})}return e.prototype.onClick=function(){this.changeAmount(this.action)},e.prototype.changeAmount=function(e){switch(e){case"+":this.cartService.setDishCountToCart(this.dish.id,this.dish.amount+1);break;case"-":this.cartService.setDishCountToCart(this.dish.id,this.dish.amount-1);break;default:console.log("Директива SetDishAmount получила ложное значение action")}},e.decorators=[{type:n.Directive,args:[{selector:"[setDishAmount]"}]}],e.ctorParameters=function(){return[{type:r}]},e.propDecorators={action:[{type:n.Input}],dish:[{type:n.Input}],onClick:[{type:n.HostListener,args:["click"]}]},e}(),l=function(){function e(e,r,t){var i=this;this.renderer=e,this.el=r,this.cartService=t,this.validate=new n.EventEmitter,this.amountDishToAdd=new n.EventEmitter,this.amountModifires={},this.stateModifiers={},this.renderer.addClass(this.el.nativeElement,"dish-calculator"),this.amountDish=1,this.amountDishToAdd.emit(this.amountDish),this.price=this.renderer.createElement("div"),this.renderer.addClass(this.price,"dish-price"),setTimeout(function(){i.renderDish(i.dish),i.render(i.dish.modifiers)},100)}return e.prototype.renderDish=function(e){var r=this,t=this.renderer.createElement("div");this.renderer.addClass(t,"dish-wraper"),this.renderer.appendChild(this.el.nativeElement,t);var i=this.renderer.createElement("div");this.renderer.addClass(i,"name"),this.renderer.appendChild(t,i);var n=this.renderer.createElement("div");this.renderer.addClass(n,"title"),this.renderer.setProperty(n,"innerHTML",this.dish.name),this.renderer.appendChild(i,n);var s=this.renderer.createElement("div");this.renderer.addClass(i,"weight"),this.renderer.addClass(i,"dish"),this.renderer.appendChild(t,s);var o=this.renderer.createElement("div");this.renderer.addClass(o,"value"),this.renderer.setProperty(o,"innerHTML",1e3*this.dish.weight+" г."),0!==this.dish.weight&&this.dish.weight||this.renderer.addClass(o,"zero"),this.renderer.appendChild(s,o),this.renderer.setProperty(this.price,"innerHTML",this.dish.price);var a=this.renderer.createElement("div");this.renderer.addClass(a,"price"),this.renderer.addClass(a,"total"),this.renderer.appendChild(a,this.price),this.renderer.appendChild(t,a);var d=this.renderer.createElement("div");this.renderer.addClass(d,"quantity"),this.renderer.appendChild(t,d);var c=this.renderer.createElement("a");this.renderer.addClass(c,"quantity__button"),this.renderer.addClass(c,"minus"),this.renderer.setProperty(c,"innerHTML","&#8722;"),this.renderer.listen(c,"click",function(e){r.changeAmountdish(-1),r.renderer.setProperty(h,"innerHTML",r.amountDish),r.renderer.setProperty(r.price,"innerHTML",r.generatePrice(r.dish.price)),r.innerTotalWeight(l)}),this.renderer.appendChild(d,c);var h=this.renderer.createElement("span");this.renderer.addClass(h,"quantity__counter"),this.renderer.setProperty(h,"innerHTML",this.amountDish),this.renderer.appendChild(d,h);var u=this.renderer.createElement("a");this.renderer.addClass(u,"quantity__button"),this.renderer.addClass(c,"plus"),this.renderer.setProperty(u,"innerHTML","&#x2b;"),this.renderer.listen(u,"click",function(e){r.changeAmountdish(1),r.renderer.setProperty(h,"innerHTML",r.amountDish),r.renderer.setProperty(r.price,"innerHTML",r.generatePrice(r.dish.price)),r.innerTotalWeight(l)}),this.renderer.appendChild(d,u);var p=this.renderer.createElement("div");this.renderer.addClass(i,"weight"),this.renderer.addClass(i,"total"),this.renderer.appendChild(t,p);var l=this.renderer.createElement("div");0!==this.dish.weight&&this.dish.weight||this.renderer.addClass(l,"zero"),this.renderer.addClass(l,"value"),this.innerTotalWeight(l),this.renderer.appendChild(p,l),this.weightTotal=l,this.renderer.setProperty(this.price,"innerHTML",this.generatePrice(e.price));var f=this.renderer.createElement("div");this.renderer.addClass(f,"price"),this.renderer.addClass(f,"total"),this.renderer.appendChild(f,this.price),this.renderer.appendChild(t,f)},e.prototype.generatePrice=function(e,r,t){var i=this,n=[];this.selectedModifiers&&this.selectedModifiers.forEach(function(t){i.dish.modifiers.forEach(function(e){var r=e.childModifiers.filter(function(e){return e.modifierId===t.id});0<r.length&&(r[0].groupId=e.group.id,n.push(r[0]))})});var s=0;return n.forEach(function(e){s+=e.dish.price*i.amountModifires[e.groupId][e.modifierId]}),s*=this.amountDish,e*this.amountDish+s+'<div class="currency">&nbsp;&#x20bd;</div>'},e.prototype.generateTotalWeight=function(){var r=this,i=[];this.selectedModifiers&&this.selectedModifiers.forEach(function(t){r.dish.modifiers.forEach(function(e){var r=e.childModifiers.filter(function(e){return e.modifierId===t.id});0<r.length&&(r[0].groupId=e.group.id,i.push(r[0]))})});var t=0;return i.forEach(function(e){t+=e.dish.weight*r.amountModifires[e.groupId][e.modifierId]*1e3}),t=parseFloat((t*this.amountDish).toFixed(2)),console.log(t,1e3*this.dish.weight*this.amountDish),console.log(this.dish.weight,this.amountDish),1e3*this.dish.weight*this.amountDish+t+" г. <div class='separator'></div>"},e.prototype.innerTotalWeight=function(e){this.renderer.setProperty(e,"innerHTML",this.generateTotalWeight())},e.prototype.changeAmountdish=function(e){this.amountDish=this.amountDish+e,this.amountDish<=0&&(this.amountDish=1),199<=this.amountDish&&(this.amountDish=199),this.amountDishToAdd.emit(this.amountDish)},e.prototype.render=function(e){var n=this;if(this.setModifires(),0<e.length){var r=this.renderer.createElement("h5");this.renderer.setProperty(r,"innerHTML","К этому блюду можно добавить:")}if(e.forEach(function(t){n.stateModifiers[t.modifierId]={},n.amountModifires[t.modifierId]={};var i=n.groupDiv(t.group?t.group.name:"Ошибка");n.renderer.appendChild(n.el.nativeElement,i),t.childModifiers.forEach(function(e){var r=n.modifireDiv(e,t.modifierId);n.renderer.appendChild(i,r),e.defaultAmount<1?n.stateModifiers[t.modifierId][e.modifierId]=!1:n.stateModifiers[t.modifierId][e.modifierId]=!0})}),0<e.length){r=this.renderer.createElement("div");this.renderer.setProperty(r,"innerHTML","<p>* — Количество добавленых опций блюда применяется для каждой порции</p>"),this.renderer.appendChild(this.el.nativeElement,r)}},e.prototype.groupDiv=function(e){var r=this.renderer.createElement("div");return this.renderer.addClass(r,"group-modifires-wraper"),this.renderer.appendChild(r,this.renderer.createText(""+e)),r},e.prototype.modifireDiv=function(e,r){var t=this.renderer.createElement("div");return this.renderer.addClass(t,"additional-item"),this.renderOneModifire(e,t,r),t},e.prototype.renderOneModifire=function(e,r,t){console.info("renderOneModifire",e),console.info("renderOneModifire selectedModifiers",this.selectedModifiers);var i=this.renderer.createElement("div");this.renderer.addClass(i,"item-name");var n=this.renderer.createElement("label");this.renderer.setAttribute(n,"for",e.modifierId),this.renderer.appendChild(i,n),this.renderer.setProperty(n,"innerHTML",e.dish.name),this.renderer.appendChild(r,i);var s=this.renderer.createElement("div");this.renderer.addClass(s,"left-weight-modifire-wraper");var o=this.renderer.createElement("div");this.renderer.addClass(o,"weight"),(0===e.dish.weight||e.dish.weight<0)&&this.renderer.addClass(o,"zero"),this.renderer.setProperty(o,"innerHTML",1e3*e.dish.weight+" г."),this.renderer.appendChild(s,o),this.renderer.appendChild(r,s);var a=this.renderer.createElement("div"),d=e.minAmount,c=e.maxAmount,h=e.defaultAmount;switch(console.info("min max def",d,c,h),!0){case 0===d&&0===c&&0===h:case 0===d&&1===c&&0===h:this.renderCheckbox(e,!1,a,r,t);break;case 0===d&&1===c&&1===h:this.renderCheckbox(e,!0,a,r,t);break;case 1===d&&1===c&&1===h:console.error(e.dish.name,"Значение не поддается настройке:",d,c,h);break;case d<=c&&d<=h&&h<=c&&1<c:this.renderInputButton(e,t,a,r);break;default:console.error(e.dish.name,"Ошибка рендера модификатора, для значений:",d,c,h)}0<e.maxAmount&&e.minAmount;var u=this.renderer.createElement("div");this.renderer.addClass(u,"right-weight-modifire-wraper");var p=this.renderer.createElement("div");this.renderer.addClass(p,"weight"),(0===e.dish.weight||e.dish.weight<0)&&this.renderer.addClass(p,"zero"),this.renderer.setProperty(p,"innerHTML",1e3*e.dish.weight+' г.<div class="separator"></div>'),this.renderer.appendChild(u,p),this.renderer.appendChild(r,u);var l,f=this.renderer.createElement("div");this.renderer.addClass(f,"item-price"),0<e.dish.price?(l=e.dish.price+"<div class = 'currency'>&nbsp;&#x20bd;</div>",this.renderer.setProperty(f,"innerHTML",l),this.renderer.appendChild(r,f)):this.renderer.addClass(f,"zero-price"),this.setModifires(),this.innerTotalWeight(this.weightTotal),this.renderer.setProperty(this.price,"innerHTML",this.generatePrice(this.dish.price))},e.prototype.renderCheckbox=function(e,r,t,i,n){var s=this,o=this.renderer.createElement("input");this.renderer.setAttribute(o,"type","checkbox"),this.renderer.setAttribute(o,"id",e.modifierId),this.amountModifires[n][e.modifierId]=r?(this.renderer.setProperty(o,"checked",!0),e.checked=!0,this.stateModifiers[n][e.modifierId]=!0,1):(e.checked=!1,this.stateModifiers[n][e.modifierId]=!1,0),this.renderer.addClass(o,"modal-checkbox"),this.renderer.appendChild(t,o),this.renderer.listen(o,"change",function(r){if(s.idRadioBox(n)){for(var e in s.stateModifiers[n])s.stateModifiers[n].hasOwnProperty(e)&&(s.stateModifiers[n][e]=!1);r.target.parentElement.parentElement.parentElement.querySelectorAll("input").forEach(function(e){e.id!=r.target.id&&(e.checked=!1)})}s.stateModifiers[n][r.target.id]=r.target.checked,r.target.checked&&(s.amountModifires[n][r.target.id]=1),s.setModifires(),s.innerTotalWeight(s.weightTotal),s.renderer.setProperty(s.price,"innerHTML",s.generatePrice(s.dish.price))}),this.renderer.appendChild(i,t)},e.prototype.renderInputButton=function(t,i,e,r){var n,s=this;0<(n=0<t.defaultAmount?t.defaultAmount:t.minAmount)&&(this.stateModifiers[i][t.modifierId]=!0);var o=this.renderer.createElement("a");this.renderer.addClass(o,"quantity__button"),this.renderer.setProperty(o,"innerHTML","&#8722;"),this.renderer.appendChild(e,o),this.renderer.listen(o,"click",function(e){var r=+s.amountModifires[i][t.modifierId];s.amountModifires[i][t.modifierId]=r-1,s.amountModifires[i][t.modifierId]<t.minAmount&&(s.amountModifires[i][t.modifierId]=t.minAmount),s.renderer.setProperty(a,"innerHTML",s.amountModifires[i][t.modifierId]),0===s.amountModifires[i][t.modifierId]&&(s.stateModifiers[i][t.modifierId]=!1),s.setModifires(),s.innerTotalWeight(s.weightTotal),s.renderer.setProperty(s.price,"innerHTML",s.generatePrice(s.dish.price))});var a=this.renderer.createElement("span");this.renderer.addClass(a,"item-quantity__counter"),this.amountModifires[i][t.modifierId]=n,this.renderer.setProperty(a,"innerHTML",this.amountModifires[i][t.modifierId]),this.renderer.appendChild(e,a);var d=this.renderer.createElement("a");this.renderer.addClass(d,"quantity__button"),this.renderer.setProperty(d,"innerHTML","&#x2b;"),this.renderer.appendChild(e,d),this.renderer.appendChild(r,e),this.renderer.listen(d,"click",function(e){var r=+s.amountModifires[i][t.modifierId];s.amountModifires[i][t.modifierId]=r+1,s.amountModifires[i][t.modifierId]>t.maxAmount&&0!=t.maxAmount&&(s.amountModifires[i][t.modifierId]=t.maxAmount),s.renderer.setProperty(a,"innerHTML",s.amountModifires[i][t.modifierId]),0<s.amountModifires[i][t.modifierId]&&(s.stateModifiers[i][t.modifierId]=!0),s.setModifires(),s.innerTotalWeight(s.weightTotal),s.renderer.setProperty(s.price,"innerHTML",s.generatePrice(s.dish.price))})},e.prototype.setModifires=function(){var n=this,e=[],s=[];for(var t in console.info("setModifires modifiersToSelect",e),console.info("setModifires stateModifiers before",this.stateModifiers),console.info("setModifires selectedModifiers before",this.selectedModifiers),this.stateModifiers){var r=function(r){(i.stateModifiers[t][r]||e.find(function(e){return e.modifierId==r}))&&s.push({id:r,amount:i.amountModifires[t][r],groupId:t})},i=this;for(var o in this.stateModifiers[t])r(o)}if(this.selectedModifiers=s,0<this.dish.modifiers.length){var a=[];this.dish.modifiers.forEach(function(e){if(e.required)if(n.stateModifiers[e.modifierId]){var r=[],t=n.stateModifiers[e.modifierId];for(var i in t)t.hasOwnProperty(i)&&t[i]&&r.push(t[i]);r.length<e.minAmount?(a.push({type:"warning",title:"Внимание",body:" Обязательно выберите модификаторы из категории: "+e.group.name}),n.validate.emit(!1),n.cartService.setModifires(s,a)):(n.validate.emit(!0),n.cartService.setModifires(s,[]))}else a.push({type:"warning",title:"Внимание",body:" Обязательно выберите модификаторы из категории: "+e.group.name}),n.validate.emit(!1),n.cartService.setModifires(s,a);else n.validate.emit(!0),n.cartService.setModifires(s)})}else this.validate.emit(!0),this.cartService.setModifires(s,[]);console.info("setModifires stateModifiers after",this.stateModifiers),console.info("setModifires selectedModifiers after",this.selectedModifiers)},e.prototype.idRadioBox=function(r){var e=this.dish.modifiers.find(function(e){return e.modifierId===r});return 1===e.minAmount&&1===e.maxAmount},e.prototype.checkMinAmountModifires=function(e,r){},e.prototype.ngOnDestroy=function(){this.validate.emit(!0),this.cartService.setModifires([],[])},e.decorators=[{type:n.Directive,args:[{selector:"[dishCalc]"}]}],e.ctorParameters=function(){return[{type:n.Renderer2},{type:n.ElementRef},{type:r}]},e.propDecorators={dish:[{type:n.Input}],amount:[{type:n.Input}],selectedModifiers:[{type:n.Input}],validate:[{type:n.Output}],amountDishToAdd:[{type:n.Output}]},e}(),f=function(){function e(e){var r=this;this.cartService=e,this.success=new n.EventEmitter,this.error=new n.EventEmitter,this.cartService.userCart().subscribe(function(e){return r.cart=e})}return e.prototype.onClick=function(){var r=this;if(this.locationId||this.streetId&&this.home){var e=this.comment||"Не указан",t=this.paymentMethod||"Не указано",i={cartId:this.cart.cartId,comment:e+"\r\nОплата: "+t,delivery:{self:this.delivery},customer:{phone:this.preparePhone(this.phone),mail:this.email,name:this.name},personsCount:this.personsCount};this.locationId?i.locationId=this.locationId:i.address={streetId:this.streetId,home:+this.home,housing:this.housing,doorphone:this.doorphone||"",entrance:this.entrance||"",floor:this.floor||"",apartment:this.apartment||""},this.cartService.orderCart(i).subscribe(function(){return r.success.emit(!0)},function(e){return r.error.emit(e)})}else this.error.emit("Нужно указать адрес")},e.prototype.preparePhone=function(e){return(e="+"+e.replace(/[^0-9]/gim,"")).replace("+8","")},e.decorators=[{type:n.Directive,args:[{selector:"[checkout]"}]}],e.ctorParameters=function(){return[{type:r}]},e.propDecorators={name:[{type:n.Input}],email:[{type:n.Input}],phone:[{type:n.Input}],delivery:[{type:n.Input}],locationId:[{type:n.Input}],streetId:[{type:n.Input}],home:[{type:n.Input}],housing:[{type:n.Input}],apartment:[{type:n.Input}],entrance:[{type:n.Input}],doorphone:[{type:n.Input}],floor:[{type:n.Input}],paymentMethod:[{type:n.Input}],personsCount:[{type:n.Input}],comment:[{type:n.Input}],success:[{type:n.Output}],error:[{type:n.Output}],onClick:[{type:n.HostListener,args:["click"]}]},e}(),m=[d,c,h,u,l,p,f],v=[],g=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{imports:a(v),providers:[],declarations:a(m),exports:a(m)}]}],e}();e.NgRestoCartService=r,e.NgRestoCartModule=g,e.ɵa=d,e.ɵb=c,e.ɵg=f,e.ɵc=h,e.ɵe=l,e.ɵd=u,e.ɵf=p,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=sails-resto-ng-cart.umd.min.js.map